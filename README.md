# ğŸ“ˆ WhatsApp AI Stock News Bot

A real-time, AI-powered stock tracking agent that lives in your WhatsApp.

This application uses **FastAPI** to handle webhooks, **LangGraph** to create a conversational agent, and **Google Gemini** to analyze financial news sentiment. It allows users to manage a watchlist via natural language and receive automated alerts when significant news drops.

## âœ¨ Features

- **ğŸ¤– Conversational AI Agent:** built with LangGraph and Gemini. You don't need to type specific commands; just talk naturally (e.g., "Please start tracking Tesla for me").
- **ğŸ“° Smart News Analysis:** Fetches real-time news via Google News RSS and uses Gemini to determine if the news is **Bullish ğŸ“ˆ**, **Bearish ğŸ“‰**, or **Neutral âš–ï¸**.
- **ğŸ”„ Automated Scraper:** Runs a background task every 10 minutes to check for new headlines without blocking the main web server.
- **ğŸ“± WhatsApp Integration:** Uses Twilio to receive user commands and push proactive news alerts.
- **ğŸ’¾ Persistent Database:** Uses SQLite to store watchlists mapped to specific WhatsApp phone numbers.

## Screenshots

![Screenshot 1](https://github.com/user-attachments/assets/ddb86d24-ed75-4916-b8eb-b2ac24573122)
![Screenshot 2](https://github.com/user-attachments/assets/1536a52d-0f45-4d79-bbf3-eb7660a6ab03)

## ğŸ› ï¸ Architecture

The system consists of two main loops:

1.  **Interaction Loop:** Receives messages via Twilio, processes them with the LangGraph Agent, executes tools (Add/Remove/View), and replies.
2.  **Scraper Loop:** An async background process that iterates through the database, checks RSS feeds, analyzes sentiment, and pushes alerts via Twilio if a new link is found.

## ğŸš€ Prerequisites

Before running the project, ensure you have:

- Python 3.9+
- A **Twilio Account** (Sid, Token, and a WhatsApp Sandbox or Sender number).
- A **Google AI Studio API Key** (for Gemini models).

## ğŸ“¦ Installation

1.  **Clone the repository**

    ```bash
    git clone https://github.com/yourusername/stock-news-bot.git
    cd stock-news-bot
    ```

2.  **Create a virtual environment**

    ```bash
    python -m venv venv
    source venv/bin/activate  # On Windows: venv\Scripts\activate
    ```

3.  **Install dependencies**
    Create a `requirements.txt` file (or use the command below) containing:
    `fastapi`, `uvicorn`, `requests`, `twilio`, `beautifulsoup4`, `python-dotenv`, `langchain-google-genai`, `langchain-core`, `langgraph`, `lxml`

    ```bash
    pip install fastapi uvicorn requests twilio beautifulsoup4 python-dotenv langchain-google-genai langchain-core langgraph lxml
    ```

4.  **Configuration**
    Create a `.env` file in the root directory and add your credentials:

    ```env
    GOOGLE_API_KEY=your_google_gemini_api_key
    TWILIO_SID=your_twilio_account_sid
    TWILIO_TOKEN=your_twilio_auth_token
    ```

## ğŸƒâ€â™‚ï¸ Usage

### 1\. Start the Server

Run the application using Uvicorn:

```bash
python main.py
```

_The server will start on port 8000, and the scraper loop will launch immediately._

### 2\. Expose to the Internet (for Twilio)

Since Twilio needs to send webhooks to your local machine, use **ngrok**:

```bash
ngrok http 8000
```

_Copy the HTTPS URL generated by ngrok (e.g., `https://a1b2.ngrok.io`)._

### 3\. Configure Twilio

1.  Go to your Twilio Console (Messaging \> Settings \> WhatsApp Sandbox Settings).
2.  Paste your ngrok URL appended with `/bot` into the **"When a message comes in"** field.
    - Example: `https://your-ngrok-url.ngrok.io/bot`
3.  Save settings.

## ğŸ’¬ How to interact

Open WhatsApp and send a message to your Twilio Sandbox number.

**Example Commands:**

| Action             | Example Message                                        |
| :----------------- | :----------------------------------------------------- |
| **Add a Stock**    | "Start tracking Apple for me" or "Add TSLA to my list" |
| **Remove a Stock** | "Stop watching Apple" or "Remove TSLA"                 |
| **View List**      | "What am I tracking?" or "Show my watchlist"           |
| **General Chat**   | "Hello\!" (The bot will respond naturally)             |

## ğŸ”” Alert Format

When the bot finds news, you will receive a message like this:

> ğŸ”” **TSLA News**
>
> ğŸ“ˆ BULLISH - Stock hits all-time high after earnings
>
> ğŸ”— [https://news.google.com/rss/articles/](https://www.google.com/search?q=https://news.google.com/rss/articles/)...

## ğŸ“‚ Project Structure

```
â”œâ”€â”€ main.py              # Main application logic (FastAPI + Agent + Scraper)
â”œâ”€â”€ stocks.db            # SQLite database (auto-generated)
â”œâ”€â”€ .env                 # API Keys (git-ignored)
â””â”€â”€ requirements.txt     # Python dependencies
```

## âš ï¸ Limitations & Notes

- **Google News Scraping:** This bot relies on the structure of Google News RSS feeds. If Google changes their XML structure, the `BeautifulSoup` parsing logic may need updates.
- **Twilio Sandbox:** The generic Twilio Sandbox has a 24-hour session window. For production use, you should apply for a dedicated WhatsApp Business API number.
- **Model:** The code uses `gemini-2.5-flash-lite`. Ensure your Google API key has access to this specific model version.
